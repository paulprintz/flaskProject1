{% extends "layout.html" %}

{% block content %}
<div class="row">
    <div class="col-sm-3 col-md-2 sidebar" {% if name is none %}style="background-color: #FFFFFF; border-right:0px;"{% endif %}>
        {% if name is not none %}
            <h2>Hello, {{ name }}!</h2>
            <p>
                <a href="/logout" class="btn btn-primary btn-large">退出登录</a></p>
            </p>
        {% endif %}
    </div>
    <div {% if name is none %}class="col-sm-6 col-sm-offset-3 col-md-8 col-md-offset-2 main" {% else %}class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main"{% endif %}>
        {% if name is none %}
            <h1>Hello</h1>
            <p>
                {{ wtf.quick_form(form) }}
            </p>
        {% else %}
            <h2 style="padding-bottom: 20px;">各课程进度</h2>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <thead>
                            {% for col in column_names_ch %}
                                <th> {{ col }} </th>
                            {% endfor %}
                        </thead>
                    </thead>
                    <tbody>
                        {% for i,row in enumerate(row_data) %}
                            <tr onclick="location.href='/works/{{row_data[i][2]}}';">
                                {% for col, row_ in zip(column_names,row) %}
                                    <td>{{ row_ }}</td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div id="main1" class="row" style="height:{{len(row_data)*80+40}}px;"></div>
        {% endif %}
        <script language="JavaScript">
            var column_names_ch={{ column_names_ch|safe }};
            var row_data={{ row_data|safe }};
            var myChart = echarts.init(document.getElementById('main1'));
            var list_data= [[],[],[],[]];
            var eWidth=$("#main1").width()*0.6+30;
            $.each(row_data,function(n,value) {
                // alert(n + ' ' + value);
                // var tmp=value.toString().split(',');
                list_data[0].push(value[1]);  // 课程名，完成节点数，总节点数
                list_data[1].push(100);
                list_data[2].push(value[3]);
                list_data[3].push(Math.round(parseInt(100)*100/parseInt(value[3])));
            });
            // 指定图表的配置项和数据
            var option = {
                title: {

                },
                tooltip: {
                    trigger: 'axis',
                    textStyle: {

                    },
                },
                legend: {
                    data:['完成活动']
                },
                grid: {
                    left: '30%'
                },
                xAxis: {
                    show: false,
                    min: 0,
                    max: 100
                },
                yAxis: {
                    type: 'category',
                    axisLine: {
                        show: false
                    },
                    axisTick: {
                        show: false
                    },
                    axisLabel: {
                        show: true,
                        textStyle: {
                            color: '#333',
                            fontFamily: 'Helvetica Neue',
                            fontsize: 14
                        }
                    },
                    data: list_data[0]
                },
                series: [{
                    name: '课程完成度',
                    type: 'bar',
                    label: {
                        show: true,
                        align: 'right',
                        position: [eWidth, '25%'],
                        distance: 0,
                        formatter:function(params){
                            return  params.data+'%'
                        },
                    },
                    showBackground: true,
                    data: list_data[3]
                }]
            };
            myChart.setOption(option);
        </script>
        <p>&emsp;</p>
        <hr />
        <footer id="footer">
            <p>&copy; {{ year }} - Helper</p>
        </footer>
    </div>
</div>

{% endblock %}
